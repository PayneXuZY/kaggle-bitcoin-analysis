name: ðŸ“ˆ Auto Update Bitcoin Chart

on:
  workflow_dispatch:     # å…è®¸æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©åŒ—äº¬æ—¶é—´ 10:00 æ‰§è¡Œï¼ˆUTC+8ï¼‰

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ“¥ Checkout repo
      uses: actions/checkout@v3

    - name: ðŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: ðŸ“¦ Install dependencies
      run: |
        pip install kaggle pandas matplotlib

    - name: ðŸ” Configure Kaggle API
      run: |
        mkdir -p ~/.kaggle
        echo "{\"username\":\"${{ secrets.KAGGLE_USERNAME }}\",\"key\":\"${{ secrets.KAGGLE_KEY }}\"}" > ~/.kaggle/kaggle.json
        chmod 600 ~/.kaggle/kaggle.json
        - name: ðŸ“Š Run auto_plot.py

      run: python auto_plot.py

    - name: ðŸš€ Commit & push chart
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "actions@github.com"
        git add sample_output.png
        git commit -m "ðŸ“ˆ Auto update chart [skip ci]" || echo "No changes to commit"
        git push
